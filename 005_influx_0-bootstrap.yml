---
- hosts: hv
  vars:
    containers:
      - influx01
  tasks:
    - name: spin up LXD container
      ansible.builtin.include_tasks: common_lxdct.yml
      with_items: '{{ containers }}'

- hosts: influx01
  roles:
    - basic
    - prom-monitored
    - loki-monitored
  tasks:
  #- name: repo key
  #  shell: curl -sL https://repos.influxdata.com/influxdb.key | sudo apt-key add -
  #- name: repo
  #  apt_repository:
  #    repo: deb https://repos.influxdata.com/ubuntu hirsute stable
  - name: package
    apt:
      name: 
        - influxdb=1.6.7~rc0-1
        - influxdb-client=1.6.7~rc0-1
  - name: start
    systemd:
      name: influxdb
      state: started
  - name: restart
    systemd:
      name: influxdb
      state: restarted    

    - name: pip module
      pip:
        name: influxdb
        executable: pip3