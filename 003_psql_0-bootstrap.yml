---
- hosts: hv
  vars:
    containers:
      - psql01
      - psql02
      - psql03
  tasks:
    - name: spin up LXD container
      ansible.builtin.include_tasks: common_lxdct.yml
      with_items: '{{containers}}'

- hosts: psql01 psql02 psql03
  roles:
    - basic
    - prom-monitored
    - loki-monitored
  tasks:
    - name: psycopg2
      pip:
        name: psycopg2-binary
        executable: pip3
    - name: packages
      apt:
        name: 
          - postgresql
          - etcd
          - patroni
          - haproxy


    - name: etcd prepare
      systemd:
        name: etcd
        state: stopped
    - name: etcd prepare
      file:
        path: /var/lib/etcd/default/
        state: absent